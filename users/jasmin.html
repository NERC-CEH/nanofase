

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Running the model on JASMIN &#8212; NanoFASE</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=5b4479735964841361fd" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=5b4479735964841361fd" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=5b4479735964841361fd" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd" />
  <script src="../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=5b4479735964841361fd"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'users/jasmin';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Speeding up model runs" href="speeding-up-model-runs.html" />
    <link rel="prev" title="Checkpointing" href="checkpointing.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="NanoFASE - Home"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="NanoFASE - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    The NanoFASE model
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../getting-started/building-the-model.html">Building the model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting-started/running-the-model.html">Runing the model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting-started/test-scenario.html">Test scenario</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Users</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="example-workflows.html">Example workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="output.html">Data output</a></li>
<li class="toctree-l1"><a class="reference internal" href="temporal-period.html">Running the model for different temporal periods</a></li>
<li class="toctree-l1"><a class="reference internal" href="batch.html">Batch runs</a></li>
<li class="toctree-l1"><a class="reference internal" href="checkpointing.html">Checkpointing</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Running the model on JASMIN</a></li>
<li class="toctree-l1"><a class="reference internal" href="speeding-up-model-runs.html">Speeding up model runs</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Theory</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../theory/intro.html">Model theory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../theory/conceptual-structure.html">Conceptual structure</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Developers</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../developers/conventions.html">Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers/io-units.html">Input/output units</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/nerc-ceh/nanofase" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/nerc-ceh/nanofase/issues/new?title=Issue%20on%20page%20%2Fusers/jasmin.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/users/jasmin.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Running the model on JASMIN</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#compiling-gcc-and-gfortran">Compiling GCC and GFortran</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#linking-libraries">Linking libraries</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#compiling-netcdf-fortran">Compiling NetCDF Fortran</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#issues-with-jaspy">Issues with Jaspy</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#compiling-the-model">Compiling the model</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="running-the-model-on-jasmin">
<h1>Running the model on JASMIN<a class="headerlink" href="#running-the-model-on-jasmin" title="Permalink to this heading">#</a></h1>
<p>The model needs GFortran 7 or later, and JASMIN only has GFortran 4.4 installed by default. GFortran 7.3.1 can be accessed on the <code class="docutils literal notranslate"><span class="pre">jasmin-sci1-test.ceda.ac.uk</span></code> machine using the Developer Toolset <code class="docutils literal notranslate"><span class="pre">devtoolset-7</span></code>. But the version of NetCDF installed was compiled with the default (v4.4) version of GFortran, and thus can’t be used with GFortran 7.3.1. In addition, <code class="docutils literal notranslate"><span class="pre">jasmin-sci1-test</span></code> server that the Developer Toolset is hosted on does not have access to LOTUS or SLURM. The only work around for this is to compile NetCDF Fortran from source (using the already installed NetCDF C) on <code class="docutils literal notranslate"><span class="pre">jasmin-sci1-test</span></code>, or install GCC <em>and</em> NetCDF Fortran from source for use on the main JASMIN sci servers (and thus have access to LOTUS/SLURM).</p>
<p>Here are brief instructions on how to do this:</p>
<section id="compiling-gcc-and-gfortran">
<h2>Compiling GCC and GFortran<a class="headerlink" href="#compiling-gcc-and-gfortran" title="Permalink to this heading">#</a></h2>
<p>This is surprisingly easy, but takes <em>a long time</em>. These instructions are based on the instructions given by GCC: <a class="reference external" href="https://gcc.gnu.org/wiki/InstallingGCC">https://gcc.gnu.org/wiki/InstallingGCC</a>.</p>
<p>For the following I will assume you download all source code into <code class="docutils literal notranslate"><span class="pre">~/software_src</span></code> and install all software into <code class="docutils literal notranslate"><span class="pre">~/software</span></code>, but you can obviously change these locations to wherever you want (as long as you have permissions for that directory).</p>
<p>First, clone the source code and checkout the v9.2.0 release. The repo is largely and cloning takes ages:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>mkdir<span class="w"> </span>~/software_src
$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>software_src
$<span class="w"> </span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/gcc-mirror/gcc
$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>gcc
$<span class="w"> </span>git<span class="w"> </span>checkout<span class="w"> </span>releases/gcc-9.2.0
</pre></div>
</div>
<p>You need to download the source code for a few dependencies, and this can be done automatically using the script provided:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>./contrib/download_prerequisites
</pre></div>
</div>
<p>Make object and install directories, e.g. at <code class="docutils literal notranslate"><span class="pre">~/software/gcc/obj</span></code> and <code class="docutils literal notranslate"><span class="pre">~/software/gcc/install</span></code> and move to the object directory:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>mkdir<span class="w"> </span>~/sofware/gcc/obj<span class="w"> </span>~/software/gcc/install
$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>~/software/gcc/obj
</pre></div>
</div>
<p>Now you need to run the configure script. This needs a couple of config parameters to install correctly on JASMIN. GCC doesn’t like you using relative paths:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>~/software_src/gcc/configure<span class="w"> </span>--prefix<span class="o">=</span>/home/users/&lt;username&gt;/software/gcc/install<span class="w"> </span>--enable-languages<span class="o">=</span>c,fortran<span class="w"> </span>--disable-multilib
</pre></div>
</div>
<p>Now make and install. The <code class="docutils literal notranslate"><span class="pre">make</span></code> step takes a <em>long</em> time (hours):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>make
$<span class="w"> </span>make<span class="w"> </span>install
</pre></div>
</div>
</section>
<section id="linking-libraries">
<h2>Linking libraries<a class="headerlink" href="#linking-libraries" title="Permalink to this heading">#</a></h2>
<p>Now you need to modify the <code class="docutils literal notranslate"><span class="pre">PATH</span></code>, <code class="docutils literal notranslate"><span class="pre">LD_LIBRARY_PATH</span></code> and <code class="docutils literal notranslate"><span class="pre">LD_RUN_PATH</span></code> variables to point to the version of GCC you’ve just installed. The best way of doing this is to add the following to the bottom of your <code class="docutils literal notranslate"><span class="pre">~/.bashrc</span></code> file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span>~/software/gcc/install/bin:<span class="nv">$PATH</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span>~/software/gcc/install/lib64:~/software/gcc/install/lib/gcc/x86_64-pc-linux-gnu/9.2.0:~/software/gcc/install/libexec/gcc/x86_64-pc-linux-gnu/9.2.0:<span class="nv">$LD_LIBRARY_PATH</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">LD_RUN_PATH</span><span class="o">=</span>~/software/gcc/install/lib64:~/software/gcc/install/lib/gcc/x86_64-pc-linux-gnu/9.2.0:~/software/gcc/install/libexec/gcc/x86_64-pc-linux-gnu/9.2.0:<span class="nv">$LD_RUN_PATH</span>
</pre></div>
</div>
<p>Logout and back in to set these variables, and now you can install NetCDFF.</p>
</section>
<section id="compiling-netcdf-fortran">
<h2>Compiling NetCDF Fortran<a class="headerlink" href="#compiling-netcdf-fortran" title="Permalink to this heading">#</a></h2>
<p>Clone netcdf-fortran from GitHub and checkout to the v4.4.1 release (don’t use the latest release, because that requires a later version of NetCDF-C than is already installed):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/Unidata/netcdf-fortran
$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>netcdf-fortran
$<span class="w"> </span>git<span class="w"> </span>checkout<span class="w"> </span>v4.4.1
</pre></div>
</div>
<p>The <a class="reference external" href="https://www.unidata.ucar.edu/software/netcdf/docs/building_netcdf_fortran.html">instructions for compiling NetCDF Fortran</a> from Unidata can now be followed, which a few modifications:</p>
<p>Set <code class="docutils literal notranslate"><span class="pre">NCDIR</span></code> to where NetCDF-C is installed, which on JASMIN is <code class="docutils literal notranslate"><span class="pre">/usr</span></code>. Set <code class="docutils literal notranslate"><span class="pre">FC</span></code> to <code class="docutils literal notranslate"><span class="pre">gfortran</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">NCDIR</span><span class="o">=</span>/usr
<span class="nv">FC</span><span class="o">=</span>gfortran
</pre></div>
</div>
<p>Set <code class="docutils literal notranslate"><span class="pre">NFDIR</span></code> to the directory where you want to install NetCDF Fortran. I’ll assume this is at <code class="docutils literal notranslate"><span class="pre">~/software/netcdff</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir<span class="w"> </span>~/software/netcdff
<span class="nv">NFDIR</span><span class="o">=</span>~/software/netcdff
</pre></div>
</div>
<p>Set CPPFLAGS to the directories for NetCDF-C. Note that on JASMIN, the lib directory is <code class="docutils literal notranslate"><span class="pre">lib64</span></code>, not <code class="docutils literal notranslate"><span class="pre">lib</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">CPPFLAGS</span><span class="o">=</span>-I<span class="si">${</span><span class="nv">NCDIR</span><span class="si">}</span>/include<span class="w"> </span><span class="nv">LDFLAGS</span><span class="o">=</span>-L<span class="si">${</span><span class="nv">NCDIR</span><span class="si">}</span>/lib64
</pre></div>
</div>
<p>Now you can configure and compile:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./configure<span class="w"> </span>--prefix<span class="o">=</span><span class="si">${</span><span class="nv">NFDIR</span><span class="si">}</span>
make<span class="w"> </span>check
make<span class="w"> </span>install
</pre></div>
</div>
<p>You need to update the <code class="docutils literal notranslate"><span class="pre">LD_LIBRARY_PATH</span></code> variable again, to include the NetCDF Fortran lib directory. Amend the <code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">LD_LIBRARY_PATH</span></code> line in your <code class="docutils literal notranslate"><span class="pre">~/.bashrc</span></code> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>export LD_LIBRARY_PATH=~/software/netcdff/lib:~/software/gcc/install/lib64:~/software/gcc/install/lib/gcc/x86_64-pc-linux-gnu/9.2.0:~/software/gcc/install/libexec/gcc/x86_64-pc-linux-gnu/9.2.0:$LD_LIBRARY_PATH
</pre></div>
</div>
<section id="issues-with-jaspy">
<h3>Issues with Jaspy<a class="headerlink" href="#issues-with-jaspy" title="Permalink to this heading">#</a></h3>
<p>Loading Jaspy (e.g via <code class="docutils literal notranslate"><span class="pre">module</span> <span class="pre">load</span> <span class="pre">jaspy</span></code>) can cause issues. For example, it is likely that your <code class="docutils literal notranslate"><span class="pre">$PATH</span></code> environment variable gets modified to include Jaspy directories first, thus overiding the changes you made to point it towards your <code class="docutils literal notranslate"><span class="pre">GCC</span></code> installation. The easiest way around this is to compile the model <em>before</em> loading Jaspy, or after you have unloaded it (<code class="docutils literal notranslate"><span class="pre">module</span> <span class="pre">unload</span> <span class="pre">jaspy</span></code>).</p>
</section>
</section>
<section id="compiling-the-model">
<h2>Compiling the model<a class="headerlink" href="#compiling-the-model" title="Permalink to this heading">#</a></h2>
<p>The model Makefile needs to be edited to point to the correct version of NetCDF. Change the variable <code class="docutils literal notranslate"><span class="pre">NETCDF</span></code> to point to the directories you just installed NetCDF Fortran in. For example, if you installed to <code class="docutils literal notranslate"><span class="pre">~/software/netcdff</span></code>, then:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">NETCDF</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>-I/home/users/&lt;username&gt;/software/netcdff/include<span class="w"> </span>-L/home/users/&lt;username&gt;/software/netcdff/lib<span class="w"> </span>-lnetcdff<span class="w"> </span>-lnetcdf
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">&lt;username&gt;</span></code> is your JASMIN username. Running the <code class="docutils literal notranslate"><span class="pre">nf-config</span></code> script at <code class="docutils literal notranslate"><span class="pre">~/software/netcdff/bin/nf-config</span></code> will give you this information:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>~/software/netcdff/bin/nf-config<span class="w"> </span>--flibs<span class="w"> </span>--fflags
</pre></div>
</div>
<p>You should now be able to compile the model using the edited Makefile.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./users"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="checkpointing.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Checkpointing</p>
      </div>
    </a>
    <a class="right-next"
       href="speeding-up-model-runs.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Speeding up model runs</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#compiling-gcc-and-gfortran">Compiling GCC and GFortran</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#linking-libraries">Linking libraries</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#compiling-netcdf-fortran">Compiling NetCDF Fortran</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#issues-with-jaspy">Issues with Jaspy</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#compiling-the-model">Compiling the model</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Sam Harrison
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=5b4479735964841361fd"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>